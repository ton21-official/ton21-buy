<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>T21 Wallet ‚Äî Mini App</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root {
      --bg: #0b0b0f;
      --panel: #13131a;
      --gold: #f0d173;
      --gold-2: #ffe794;
      --text: #e9e9e9;
      --muted: #9aa0a6;
      --danger: #ff6b6b;
      --ok: #27d980;
      --btn-shadow: 0 6px 20px rgba(240,209,115,.15);
      --radius: 14px;
    }
    * { box-sizing: border-box }
    body {
      margin:0; background:var(--bg); color:var(--text);
      font: 16px/1.45 system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    .wrap { max-width: 920px; margin: 22px auto 80px; padding: 0 14px; }
    .hero { text-align:center; margin-bottom: 18px; }
    .logo-wrap {
      width:108px; height:108px; margin:10px auto 12px; border-radius:50%;
      background: radial-gradient(60% 60% at 50% 50%, rgba(240,209,115,.35), rgba(0,0,0,0));
      display:grid; place-items:center;
    }
    .logo {
      width:92px; height:92px; border-radius:50%; border:2px solid var(--gold);
      background:#000 center/cover no-repeat;
      background-image:url("https://raw.githubusercontent.com/ton21-official/ton21-logo/main/t21_logo_gold.png");
      box-shadow: 0 0 28px rgba(240,209,115,.35);
    }
    h1 {
      margin:0 0 6px; font-weight:800; letter-spacing:.2px;
      text-shadow: 0 0 24px rgba(240,209,115,.25);
      color: var(--gold);
      font-size: clamp(22px, 4.8vw, 30px);
    }
    .sub { color:#cfcfcf; font-size:15px; text-align:center; margin:0 8px 18px }
    .card {
      background:var(--panel); border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius); padding:18px; margin: 0 auto 16px; max-width:780px;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap }
    .input {
      flex:1 1 520px; background:#0e0e14; color:var(--text);
      border:1px solid rgba(255,255,255,.08);
      padding:14px 14px; border-radius: 10px; outline:none;
      font-size:15px;
    }
    .input::placeholder{ color:#7d8590 }
    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      background:var(--gold); color:#0b0b0f; border:0; border-radius:10px;
      padding:12px 16px; font-weight:700; cursor:pointer;
      box-shadow: var(--btn-shadow); transition:.2s transform,.2s background;
      min-width:132px;
    }
    .btn:hover { background:var(--gold-2); transform: translateY(-1px) }
    .pill { background:#0e0e14; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:8px 12px; }
    .stat {
      display:flex; gap:10px; justify-content:space-between; text-align:center;
      background:#0e0e14; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px 14px; margin-top:12px;
    }
    .stat > div { flex:1 }
    .label { color:var(--muted); font-size:12px; letter-spacing:.3px }
    .value { font-size:20px; font-weight:800; margin-top:6px }
    .ok { color: var(--ok) }
    .err { color: var(--danger) }
    .grid { display:grid; gap:12px; grid-template-columns: 1fr }
    @media (min-width:680px){ .grid { grid-template-columns: 1fr 1fr } }
    .cta .btn { width:100% }
    .langbar{ display:flex; gap:10px; align-items:center; justify-content:center; margin-top:14px; color:#aab0b8; }
    .langbar button{
      border:1px solid var(--gold); color:var(--gold); background:transparent;
      padding:6px 10px; border-radius:8px; cursor:pointer; min-width:44px; font-weight:700
    }
    footer { text-align:center; color:#7f8691; margin-top:18px; font-size:13px }
    .hint { font-size:12px; color:#a2a8b3; margin-top:8px; text-align:center }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <div class="logo-wrap"><div class="logo"></div></div>
      <h1 id="t-title">‚ú® Welcome to T21 Wallet ‚ú®</h1>
      <p class="sub" id="t-sub">üíé Your decentralized gateway to the Ton21 ecosystem.</p>
    </div>

    <div class="card">
      <div class="row" style="margin-bottom:10px">
        <input id="addr" class="input" placeholder="Paste Tonkeeper address (starts with UQ or EQ)" />
        <button id="save" class="btn">üíæ <span id="t-save">Save</span></button>
      </div>

      <div class="row" style="margin-bottom:8px">
        <button id="refresh" class="btn">üîÑ <span id="t-refresh">Refresh</span></button>
        <div id="status" class="pill" style="flex:1; text-align:center;"></div>
      </div>

      <div class="stat">
        <div>
          <div class="label">TON</div>
          <div id="ton" class="value">‚Äî</div>
        </div>
        <div>
          <div class="label">T21</div>
          <div id="t21" class="value">‚Äî</div>
        </div>
      </div>

      <div class="hint" id="t-hint">Enter Tonkeeper address (starts with UQ or EQ)</div>
    </div>

    <div class="card cta">
      <div class="grid" style="margin-bottom:8px">
        <a class="btn" id="buyBtn">üí∞ <span id="t-buy">Buy $T21</span></a>
        <a class="btn" id="swapBtn">üîÅ <span id="t-swap">Swap / Exchange</span></a>
      </div>
      <div class="grid">
        <a class="btn" id="portalBtn">üåê <span id="t-portal">Ton21 Portal</span></a>
        <a class="btn" id="assistantBtn">ü™ô <span id="t-assistant">Buy Assistant</span></a>
      </div>
      <div class="langbar">
        üåê <span id="t-language">Language:</span>
        <button data-lang="ru">RU</button>
        <button data-lang="en">GB</button>
        <button data-lang="zh">CN</button>
        <button data-lang="hi">IN</button>
      </div>
    </div>

    <footer>¬© 2025 Ton21 Project ‚Äî All rights reserved</footer>
  </div>

  <script>
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // 0) Telegram Mini App init + helpers
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    (function initWA(){
      try {
        if (window.Telegram && Telegram.WebApp) {
          Telegram.WebApp.ready();
          Telegram.WebApp.expand();
        }
      } catch(e){}
    })();

    function openLink(url){
      try{
        if (window.Telegram && Telegram.WebApp) return Telegram.WebApp.openLink(url);
      }catch(e){}
      window.open(url, "_blank");
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // 1) Settings
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const T21_MASTER = "EQBLgiPMly982IMGqauqdX0Fe_N01arD-LhlKSfxBd8rzYRG";
    // –í—Å—Ç–∞–≤—å —Å–≤–æ–π –∫–ª—é—á (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ). –ú–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º ‚Äî –±—É–¥–µ—Ç –ø–∞–±–ª–∏–∫ –¥–æ—Å—Ç—É–ø.
    const TONCENTER_KEY = "6c157ea65ec504b0aa2d83c2f68efe872f796755bf1445b1e5168da2e452b83a".trim();

    const LINKS = {
      BUY:   "https://dedust.io/swap/TON/T21",
      SWAP:  "https://dedust.io/swap/T21/TON",
      PORTAL:"https://t.me/Ton21PortalBot",
      ASSIST:"https://t.me/T21BuyBot"
    };

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // 2) i18n
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const I18N = {
      en: {
        title:"‚ú® Welcome to T21 Wallet ‚ú®",
        sub:"üíé Your decentralized gateway to the Ton21 ecosystem.",
        save:"Save", refresh:"Refresh",
        hint:"Enter Tonkeeper address (starts with UQ or EQ)",
        buy:"Buy $T21", swap:"Swap / Exchange", portal:"Ton21 Portal", assistant:"Buy Assistant",
        language:"Language:",
        savedOk:"‚úÖ Address saved", wrong:"‚ö†Ô∏è Invalid address",
        loading:"‚è≥ Loading‚Ä¶", netbusy:"‚ö†Ô∏è Network is busy, try again later",
        noaddr:"‚ö†Ô∏è Add address first"
      },
      ru: {
        title:"‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ T21 –ö–æ—à–µ–ª—ë–∫ ‚ú®",
        sub:"üíé –¢–≤–æ–π –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç–∞–ª –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º—É Ton21.",
        save:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å", refresh:"–û–±–Ω–æ–≤–∏—Ç—å",
        hint:"–í—Å—Ç–∞–≤—å Tonkeeper-–∞–¥—Ä–µ—Å (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å UQ –∏–ª–∏ EQ)",
        buy:"–ö—É–ø–∏—Ç—å $T21", swap:"–û–±–º–µ–Ω / Swap", portal:"–ü–æ—Ä—Ç–∞–ª Ton21", assistant:"–ü–æ–º–æ—â–Ω–∏–∫ –ø–æ–∫—É–ø–∫–∏",
        language:"–Ø–∑—ã–∫:",
        savedOk:"‚úÖ –ê–¥—Ä–µ—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω", wrong:"‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å",
        loading:"‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶", netbusy:"‚ö†Ô∏è –°–µ—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ",
        noaddr:"‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –∞–¥—Ä–µ—Å"
      },
      zh: {
        title:"‚ú® Ê¨¢Ëøé‰ΩøÁî® T21 Èí±ÂåÖ ‚ú®",
        sub:"üíé ËøõÂÖ• Ton21 ÁîüÊÄÅÁ≥ªÁªüÁöÑÂéª‰∏≠ÂøÉÂåñÈó®Êà∑„ÄÇ",
        save:"‰øùÂ≠ò", refresh:"Âà∑Êñ∞",
        hint:"Á≤òË¥¥ Tonkeeper Âú∞ÂùÄÔºà‰ª• UQ Êàñ EQ ÂºÄÂ§¥Ôºâ",
        buy:"Ë¥≠‰π∞ $T21", swap:"‰ª£Â∏Å‰∫§Êç¢", portal:"Ton21 Èó®Êà∑", assistant:"Ë¥≠‰π∞Âä©Êâã",
        language:"ËØ≠Ë®ÄÔºö",
        savedOk:"‚úÖ Âú∞ÂùÄÂ∑≤‰øùÂ≠ò", wrong:"‚ö†Ô∏è Âú∞ÂùÄÊó†Êïà",
        loading:"‚è≥ ËΩΩÂÖ•‰∏≠‚Ä¶", netbusy:"‚ö†Ô∏è ÁΩëÁªúÁπÅÂøôÔºåËØ∑Á®çÂêéÈáçËØï",
        noaddr:"‚ö†Ô∏è ËØ∑ÂÖàÊ∑ªÂä†Âú∞ÂùÄ"
      },
      hi: {
        title:"‚ú® T21 ‡§µ‡•â‡§≤‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à ‚ú®",
        sub:"üíé Ton21 ‡§™‡§æ‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§ï‡•Ä ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§Ü‡§™‡§ï‡§æ ‡§µ‡§ø‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡•Ä‡§ï‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§¶‡•ç‡§µ‡§æ‡§∞‡•§",
        save:"‡§∏‡§π‡•á‡§ú‡•á‡§Ç", refresh:"‡§∞‡•Ä‡§´‡§º‡•ç‡§∞‡•á‡§∂",
        hint:"Tonkeeper ‡§™‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç (UQ ‡§Ø‡§æ EQ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç)",
        buy:"$T21 ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç", swap:"‡§ü‡•ã‡§ï‡§® ‡§∏‡•ç‡§µ‡•à‡§™", portal:"Ton21 ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤", assistant:"‡§ñ‡§∞‡•Ä‡§¶ ‡§∏‡§π‡§æ‡§Ø‡§ï",
        language:"‡§≠‡§æ‡§∑‡§æ:",
        savedOk:"‚úÖ ‡§™‡§§‡§æ ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ", wrong:"‚ö†Ô∏è ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡§§‡§æ",
        loading:"‚è≥ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à‚Ä¶", netbusy:"‚ö†Ô∏è ‡§®‡•á‡§ü‡§µ‡§∞‡•ç‡§ï ‡§µ‡•ç‡§Ø‡§∏‡•ç‡§§ ‡§π‡•à, ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç",
        noaddr:"‚ö†Ô∏è ‡§™‡§π‡§≤‡•á ‡§™‡§§‡§æ ‡§ú‡•ã‡§°‡§º‡•á‡§Ç"
      }
    };
    const els = {
      title:    document.getElementById("t-title"),
      sub:      document.getElementById("t-sub"),
      save:     document.getElementById("t-save"),
      refresh:  document.getElementById("t-refresh"),
      hint:     document.getElementById("t-hint"),
      buy:      document.getElementById("t-buy"),
      swap:     document.getElementById("t-swap"),
      portal:   document.getElementById("t-portal"),
      assist:   document.getElementById("t-assistant"),
      langlab:  document.getElementById("t-language"),
      addr:     document.getElementById("addr"),
      status:   document.getElementById("status"),
      ton:      document.getElementById("ton"),
      t21:      document.getElementById("t21"),
      saveBtn:  document.getElementById("save"),
      refreshBtn: document.getElementById("refresh"),
      buyBtn:   document.getElementById("buyBtn"),
      swapBtn:  document.getElementById("swapBtn"),
      portalBtn:document.getElementById("portalBtn"),
      assistantBtn:document.getElementById("assistantBtn"),
    };

    function setLang(lang){
      const t = I18N[lang] || I18N.en;
      els.title.textContent = t.title;
      els.sub.textContent = t.sub;
      els.save.textContent = t.save;
      els.refresh.textContent = t.refresh;
      els.hint.textContent = t.hint;
      els.buy.textContent = t.buy;
      els.swap.textContent = t.swap;
      els.portal.textContent = t.portal;
      els.assist.textContent = t.assistant;
      els.langlab.textContent = t.language;
      localStorage.setItem("t21_lang", lang);
    }
    document.querySelectorAll(".langbar button").forEach(b=>{
      b.addEventListener("click", ()=> setLang(b.dataset.lang));
    });

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // 3) Links
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    els.buyBtn.onclick      = ()=> openLink(LINKS.BUY);
    els.swapBtn.onclick     = ()=> openLink(LINKS.SWAP);
    els.portalBtn.onclick   = ()=> openLink(LINKS.PORTAL);
    els.assistantBtn.onclick= ()=> openLink(LINKS.ASSIST);

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // 4) Balances (Toncenter ‚Üí alt Toncenter ‚Üí TON API)
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    async function httpGet(url){
      const res = await fetch(url, {method:"GET"});
      if(!res.ok) throw new Error("HTTP "+res.status);
      return res.json();
    }

    function fmtTON(n){ return Number(n).toLocaleString(undefined,{maximumFractionDigits:4}) }
    function fmtT21(n){ return Number(n).toLocaleString(undefined,{maximumFractionDigits:2}) }

    async function toncenterBalance(addr){
      const base = "https://toncenter.com/api/v2";
      const keyQ = TONCENTER_KEY ? `&api_key=${encodeURIComponent(TONCENTER_KEY)}` : "";
      const a = await httpGet(`${base}/getAddressBalance?address=${addr}${keyQ}`);
      const ton = (a.result? Number(a.result)/1e9 : 0);

      // Jetton (T21)
      let t21 = 0;
      try{
        const j = await httpGet(`${base}/get_jetton_wallet_info?address=${addr}&jetton_master=${T21_MASTER}${keyQ}`);
        if (j.result && j.result.balance) t21 = Number(j.result.balance)/1e9;
      }catch(e){ /* not created ‚Üí 0 */ }

      return {ton, t21};
    }

    async function toncenterAlt(addr){
      // –∑–µ—Ä–∫–∞–ª—å–Ω—ã–π —Ö–æ—Å—Ç (–Ω–∞ —Å–ª—É—á–∞–π –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ)
      const base = "https://toncenter.com/api/v2"; // –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–π –∑–µ—Ä–∫–∞–ª—å–Ω—ã–π —É–∑–µ–ª
      const keyQ = TONCENTER_KEY ? `&api_key=${encodeURIComponent(TONCENTER_KEY)}` : "";
      const a = await httpGet(`${base}/getAddressBalance?address=${addr}${keyQ}`);
      const ton = (a.result? Number(a.result)/1e9 : 0);

      let t21 = 0;
      try{
        const j = await httpGet(`${base}/get_jetton_wallet_info?address=${addr}&jetton_master=${T21_MASTER}${keyQ}`);
        if (j.result && j.result.balance) t21 = Number(j.result.balance)/1e9;
      }catch(e){}
      return {ton, t21};
    }

    async function tonapiBalance(addr){
      // –ø—É–±–ª–∏—á–Ω—ã–π TON API
      const a = await httpGet(`https://tonapi.io/v2/accounts/${addr}`);
      const ton = a.balance? Number(a.balance)/1e9 : 0;

      let t21 = 0;
      try{
        const j = await httpGet(`https://tonapi.io/v2/accounts/${addr}/jettons`);
        if (Array.isArray(j.balances)) {
          const hit = j.balances.find(b => (b.jetton && (b.jetton.address===T21_MASTER)));
          if (hit) {
            // —É –Ω–∏—Ö –±–∞–ª–∞–Ω—Å –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π –≤ –Ω–∞–Ω–æ–¥–∂–µ—Ç—Ç–æ–Ω–∞—Ö:
            const raw = hit.balance ?? 0;
            t21 = Number(raw)/1e9;
          }
        }
      }catch(e){}
      return {ton, t21};
    }

    async function loadBalances(addr){
      const lang = localStorage.getItem("t21_lang") || "ru";
      const T = I18N[lang] || I18N.en;
      els.status.textContent = T.loading;
      els.status.style.color = "";

      try {
        // 1) –æ—Å–Ω–æ–≤–Ω–æ–π toncenter
        return await toncenterBalance(addr);
      } catch (e1) {
        try {
          // 2) –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π (–º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–π –ø—Ä–æ–∫—Å–∏/–Ω–æ–¥)
          return await toncenterAlt(addr);
        } catch (e2) {
          // 3) —Ç–æ–Ω-–∞–ø–∏
          try{
            return await tonapiBalance(addr);
          }catch(e3){
            throw e3;
          }
        }
      }
    }

    async function refresh(){
      const lang = localStorage.getItem("t21_lang") || "ru";
      const T = I18N[lang] || I18N.en;
      const addr = (els.addr.value||"").trim();

      if (!/^(UQ|EQ)/.test(addr) || addr.length < 36){
        els.status.textContent = T.wrong;
        els.status.className = "pill err";
        return;
      }

      els.status.textContent = T.loading;
      els.status.className = "pill";

      try{
        const {ton, t21} = await loadBalances(addr);
        els.ton.textContent = fmtTON(ton);
        els.t21.textContent = fmtT21(t21);
        els.status.textContent = "‚úÖ OK";
        els.status.className = "pill ok";
      }catch(err){
        els.status.textContent = T.netbusy;
        els.status.className = "pill err";
        els.ton.textContent = "‚Äî";
        els.t21.textContent = "‚Äî";
      }
    }

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // 5) Save / Restore / Events
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function saveAddr(){
      const lang = localStorage.getItem("t21_lang") || "ru";
      const T = I18N[lang] || I18N.en;
      const a = (els.addr.value||"").trim();
      if (!/^(UQ|EQ)/.test(a) || a.length < 36){
        els.status.textContent = T.wrong;
        els.status.className = "pill err";
        return;
      }
      localStorage.setItem("t21_addr", a);
      els.status.textContent = T.savedOk;
      els.status.className = "pill ok";
    }

    els.saveBtn.addEventListener("click", saveAddr);
    els.refreshBtn.addEventListener("click", refresh);
    els.addr.addEventListener("keydown", (e)=>{ if(e.key==="Enter") saveAddr() });

    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // 6) Boot
    // ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    (function boot(){
      const lang = localStorage.getItem("t21_lang") || "ru";
      setLang(lang);

      const a = localStorage.getItem("t21_addr");
      if (a) els.addr.value = a;

      // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–¥—Ä–µ—Å–∞
      if (a) refresh();
      
      // –∫–Ω–æ–ø–∫–∏ ‚Äî —ç—Ç–æ —Å—Å—ã–ª–∫–∏, –Ω–æ –æ—Ç–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ Telegram
      document.querySelectorAll("a.btn").forEach(a=>{
        const id = a.id;
        a.href = "javascript:void(0)";
      });
    })();
  </script>
</body>
</html>
