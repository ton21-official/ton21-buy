<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ton21 Wallet â€” Mini App</title>
  <style>
    body{background:radial-gradient(circle at center,#0d0d12 0%,#000 100%);color:#f8e49a;
      font-family:"Segoe UI",Arial,sans-serif;text-align:center;margin:0;padding:0;overflow-x:hidden}
    header{padding:40px 10px 16px}
    header img{width:110px;height:110px;border-radius:50%;border:3px solid #f8e49a;
      box-shadow:0 0 25px 8px rgba(255,215,100,.4);animation:pulse 3s infinite ease-in-out}
    @keyframes pulse{0%{box-shadow:0 0 20px 4px rgba(255,215,100,.4)}
      50%{box-shadow:0 0 40px 15px rgba(255,215,100,.7)}100%{box-shadow:0 0 20px 4px rgba(255,215,100,.4)}}
    h1{font-size:26px;color:#ffdc73;margin:16px 0 6px;text-shadow:0 0 10px #f1c84b}
    p.sub{color:#d6d6d6;font-size:15px;margin:0 24px 18px;line-height:1.4}

    .card{background:rgba(255,255,255,.05);border:1px solid #f8e49a33;border-radius:14px;
      padding:16px;margin:12px auto;max-width:420px}
    .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px}
    input.addr{flex:1;min-width:240px;max-width:420px;background:#101018;color:#fff;border:1px solid #f8e49a33;
      border-radius:10px;padding:12px 14px;font-size:14px;outline:none}
    .btn{display:inline-block;background:linear-gradient(180deg,#f8e49a,#e4c55c);color:#0b0b0f;border:none;
      border-radius:10px;padding:12px 16px;font-size:15px;font-weight:700;cursor:pointer;transition:.2s}
    .btn:hover{transform:scale(1.03);box-shadow:0 0 18px rgba(255,230,120,.6)}
    .btn.link{width:80%;max-width:320px;display:block;margin:10px auto}

    .balances{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .tile{background:#0f121a;border:1px solid #f8e49a33;border-radius:10px;padding:12px}
    .tile h4{margin:0 0 6px;font-size:13px;color:#cfcfcf}
    .val{font-size:18px;font-weight:800;color:#ffea9f}

    .lang{margin:18px 0 10px;font-size:14px;color:#aaa}
    .lang button{background:none;border:1px solid #f8e49a;color:#f8e49a;margin:4px;border-radius:6px;
      padding:4px 10px;cursor:pointer}
    .muted{color:#a1a1a1;font-size:12px;margin-top:6px}
    footer{margin:24px 0 26px;color:#777;font-size:13px}
    .err{color:#ffb3b3;font-size:13px;margin-top:8px}
    .ok{color:#9fffb3;font-size:13px;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png" alt="Ton21 Logo"/>
    <h1 id="t_title">âœ¨ Welcome to Ton21 Wallet âœ¨</h1>
    <p class="sub" id="t_desc">ğŸ’ Your decentralized gateway to the Ton21 ecosystem.</p>
  </header>

  <!-- Address & Actions -->
  <div class="card">
    <div class="row">
      <input id="addr" class="addr" placeholder="UQ... / EQ..." />
      <button class="btn" id="btn_save">ğŸ’¾ Save</button>
      <button class="btn" id="btn_refresh">ğŸ”„ Refresh</button>
    </div>
    <div class="muted" id="hint">Paste your Tonkeeper address (starts with UQ or EQ)</div>
    <div id="msg"></div>

    <div class="balances">
      <div class="tile">
        <h4>TON</h4>
        <div class="val" id="ton_val">â€”</div>
      </div>
      <div class="tile">
        <h4>T21</h4>
        <div class="val" id="t21_val">â€”</div>
      </div>
    </div>
  </div>

  <!-- Links -->
  <div class="card">
    <button class="btn link" onclick="openLink('https://dedust.io/swap/TON/T21')" id="b1">ğŸ’° Buy $T21</button>
    <button class="btn link" onclick="openLink('https://dedust.io/swap/T21/TON')" id="b2">ğŸ” Swap Tokens</button>
    <button class="btn link" onclick="openLink('https://t.me/Ton21PortalBot')" id="b5">ğŸŒ Ton21 Portal</button>
    <button class="btn link" onclick="openLink('https://t.me/T21BuyBot')" id="b4">ğŸª™ Buy Assistant</button>
  </div>

  <!-- Language -->
  <div class="lang">
    ğŸŒ Language:
    <button onclick="setLang('ru')">ğŸ‡·ğŸ‡º</button>
    <button onclick="setLang('en')">ğŸ‡¬ğŸ‡§</button>
    <button onclick="setLang('zh')">ğŸ‡¨ğŸ‡³</button>
    <button onclick="setLang('hi')">ğŸ‡®ğŸ‡³</button>
  </div>

  <footer>Â© 2025 Ton21 Project â€” All rights reserved</footer>

  <script>
    // ========= CONFIG =========
    const TONCENTER_URL = "https://toncenter.com/api/v2/";
    const TONCENTER_KEY = "7b7dbe074f508388d81130af3a79b5a2cf955084f3e3b088aa7ecba4419c2317";
    const T21_MASTER    = "EQBLgiPMly982IMGqauqdX0Fe_N01arD-LhlKSfxBd8rzYRG";

    // If CORS ÑƒĞ¿Ñ€Ñ‘Ñ‚ÑÑ, ÑƒĞºĞ°Ğ¶Ğ¸ Ğ°Ğ´Ñ€ĞµÑ ÑĞ²Ğ¾ĞµĞ³Ğ¾ Ğ»Ñ‘Ğ³ĞºĞ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾ĞºÑĞ¸ (Ğ¾ÑÑ‚Ğ°Ğ²ÑŒ "" Ğ´Ğ»Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²):
    // Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ proxy: https://your-render-app.onrender.com/toncenter?path=...&params=...
    const proxyUrl = ""; // Ğ»Ğ¸Ğ±Ğ¾ "" Ğ´Ğ»Ñ Ğ¿Ñ€ÑĞ¼Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²

    // ========= I18N =========
    const T = {
      en:{title:"âœ¨ Welcome to Ton21 Wallet âœ¨", desc:"ğŸ’ Your decentralized gateway to the Ton21 ecosystem.",
        hint:"Paste your Tonkeeper address (starts with UQ or EQ)",
        saved:"âœ… Address saved", invalid:"âš ï¸ Invalid address", errFetch:"âš ï¸ Error: ", okUpdated:"âœ… Updated",
        b1:"ğŸ’° Buy $T21", b2:"ğŸ” Swap Tokens", b4:"ğŸª™ Buy Assistant", b5:"ğŸŒ Ton21 Portal"},
      ru:{title:"âœ¨ Ğ”Ğ¾Ğ±Ñ€Ğ¾ Ğ¿Ğ¾Ğ¶Ğ°Ğ»Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² Ton21 ĞšĞ¾ÑˆĞµĞ»Ñ‘Ğº âœ¨", desc:"ğŸ’ Ğ¢Ğ²Ğ¾Ğ¹ Ğ´ĞµÑ†ĞµĞ½Ñ‚Ñ€Ğ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ğ¿Ğ¾Ñ€Ñ‚Ğ°Ğ» Ğ² ÑĞºĞ¾ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ton21.",
        hint:"Ğ’ÑÑ‚Ğ°Ğ²ÑŒ Tonkeeper-Ğ°Ğ´Ñ€ĞµÑ (Ğ½Ğ°Ñ‡Ğ¸Ğ½Ğ°ĞµÑ‚ÑÑ Ñ UQ Ğ¸Ğ»Ğ¸ EQ)",
        saved:"âœ… ĞĞ´Ñ€ĞµÑ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½", invalid:"âš ï¸ ĞĞµĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ñ€ĞµÑ", errFetch:"âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ°: ", okUpdated:"âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾",
        b1:"ğŸ’° ĞšÑƒĞ¿Ğ¸Ñ‚ÑŒ $T21", b2:"ğŸ” ĞĞ±Ğ¼ĞµĞ½ / Swap", b4:"ğŸª™ ĞŸĞ¾Ğ¼Ğ¾Ñ‰Ğ½Ğ¸Ğº Ğ¿Ğ¾ĞºÑƒĞ¿ĞºĞ¸", b5:"ğŸŒ ĞŸĞ¾Ñ€Ñ‚Ğ°Ğ» Ton21"},
      zh:{title:"âœ¨ æ¬¢è¿æ¥åˆ° Ton21 é’±åŒ… âœ¨", desc:"ğŸ’ è¿›å…¥ Ton21 ç”Ÿæ€ç³»ç»Ÿçš„å»ä¸­å¿ƒåŒ–é—¨æˆ·ã€‚",
        hint:"ç²˜è´´ Tonkeeper åœ°å€ï¼ˆä»¥ UQ æˆ– EQ å¼€å¤´ï¼‰",
        saved:"âœ… åœ°å€å·²ä¿å­˜", invalid:"âš ï¸ åœ°å€æ— æ•ˆ", errFetch:"âš ï¸ é”™è¯¯ï¼š", okUpdated:"âœ… å·²æ›´æ–°",
        b1:"ğŸ’° è´­ä¹° $T21", b2:"ğŸ” ä»£å¸äº¤æ¢", b4:"ğŸª™ è´­ä¹°åŠ©æ‰‹", b5:"ğŸŒ Ton21 é—¨æˆ·"},
      hi:{title:"âœ¨ Ton21 à¤µà¥‰à¤²à¥‡à¤Ÿ à¤®à¥‡à¤‚ à¤†à¤ªà¤•à¤¾ à¤¸à¥à¤µà¤¾à¤—à¤¤ à¤¹à¥ˆ âœ¨", desc:"ğŸ’ Ton21 à¤ªà¤¾à¤°à¤¿à¤¸à¥à¤¥à¤¿à¤¤à¤¿à¤•à¥€ à¤¤à¤‚à¤¤à¥à¤° à¤•à¤¾ à¤†à¤ªà¤•à¤¾ à¤µà¤¿à¤•à¥‡à¤‚à¤¦à¥à¤°à¥€à¤•à¥ƒà¤¤ à¤ªà¥à¤°à¤µà¥‡à¤¶ à¤¦à¥à¤µà¤¾à¤°à¥¤",
        hint:"Tonkeeper à¤ªà¤¤à¤¾ à¤ªà¥‡à¤¸à¥à¤Ÿ à¤•à¤°à¥‡à¤‚ (UQ à¤¯à¤¾ EQ à¤¸à¥‡ à¤¶à¥à¤°à¥‚ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ)",
        saved:"âœ… à¤ªà¤¤à¤¾ à¤¸à¤¹à¥‡à¤œà¤¾ à¤—à¤¯à¤¾", invalid:"âš ï¸ à¤…à¤®à¤¾à¤¨à¥à¤¯ à¤ªà¤¤à¤¾", errFetch:"âš ï¸ à¤¤à¥à¤°à¥à¤Ÿà¤¿: ", okUpdated:"âœ… à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾",
        b1:"ğŸ’° $T21 à¤–à¤°à¥€à¤¦à¥‡à¤‚", b2:"ğŸ” à¤Ÿà¥‹à¤•à¤¨ à¤¸à¥à¤µà¥ˆà¤ª à¤•à¤°à¥‡à¤‚", b4:"ğŸª™ à¤–à¤°à¥€à¤¦ à¤¸à¤¹à¤¾à¤¯à¤•", b5:"ğŸŒ Ton21 à¤ªà¥‹à¤°à¥à¤Ÿà¤²"}
    };

    function setLang(lang){
      const t=T[lang]||T.en;
      document.getElementById("t_title").innerText=t.title;
      document.getElementById("t_desc").innerText=t.desc;
      document.getElementById("hint").innerText=t.hint;
      document.getElementById("b1").innerText=t.b1;
      document.getElementById("b2").innerText=t.b2;
      document.getElementById("b4").innerText=t.b4;
      document.getElementById("b5").innerText=t.b5;
      localStorage.setItem("t21_lang",lang);
    }

    // ========= Helpers =========
    function openLink(url){
      if(window.Telegram&&Telegram.WebApp){Telegram.WebApp.openLink(url);} else {window.open(url,"_blank");}
    }
    const $ = id => document.getElementById(id);
    function validAddr(a){ return (a||"").trim().match(/^(UQ|EQ)[A-Za-z0-9\-_]{30,}$/); }

    async function tcGet(path, params={}){
      const p = new URLSearchParams({...params, api_key: TONCENTER_KEY}).toString();
      if(proxyUrl){
        // Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€Ğ¾ĞºÑĞ¸
        const u = `${proxyUrl}&path=${encodeURIComponent(path)}&${p}`;
        const r = await fetch(u);
        return r.json();
      }else{
        // Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ Ğ²Ñ‹Ğ·Ğ¾Ğ²
        const u = `${TONCENTER_URL}${path}?${p}`;
        const r = await fetch(u);
        return r.json();
      }
    }

    async function getTonBalance(address){
      const j = await tcGet("getAddressBalance",{address});
      if(!("result" in j)) throw new Error(j.error||"no result");
      return Number(j.result)/1e9;
    }

    async function getT21Balance(address){
      // ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ jetton_wallet_info Ğ¿Ğ¾ master ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñƒ T21
      const j = await tcGet("get_jetton_wallet_info",{address, jetton_master:T21_MASTER});
      const res = j.result || {};
      if("balance" in res){ return Number(res.balance)/1e9; }
      return 0.0; // ĞµÑĞ»Ğ¸ ĞºĞ¾ÑˆĞµĞ»Ñ‘Ğº jetton Ğ½Ğµ Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ğ½ÑƒÑ‚
    }

    async function refresh(){
      const addr = $("addr").value.trim();
      const msg = $("msg");
      msg.className = ""; msg.textContent = "";
      if(!validAddr(addr)){ msg.className="err"; msg.textContent=T[currentLang].invalid; return; }

      $("ton_val").textContent = "â€¦";
      $("t21_val").textContent = "â€¦";

      try{
        const [ton,t21] = await Promise.all([getTonBalance(addr), getT21Balance(addr)]);
        $("ton_val").textContent = ton.toFixed(4);
        $("t21_val").textContent = t21.toFixed(2);
        msg.className="ok"; msg.textContent=T[currentLang].okUpdated;
        localStorage.setItem("t21_addr", addr);
      }catch(e){
        $("ton_val").textContent = "â€”";
        $("t21_val").textContent = "â€”";
        msg.className="err"; msg.textContent = T[currentLang].errFetch + (e.message||e);
      }
    }

    // ========= Init =========
    let currentLang = localStorage.getItem("t21_lang") || (navigator.language||"en").slice(0,2);
    if(!T[currentLang]) currentLang="en";
    setLang(currentLang);

    const saved = localStorage.getItem("t21_addr");
    if(saved){ $("addr").value = saved; }

    $("btn_save").onclick = ()=>{
      const v = $("addr").value.trim();
      if(!validAddr(v)){ $("msg").className="err"; $("msg").textContent=T[currentLang].invalid; return; }
      localStorage.setItem("t21_addr", v);
      $("msg").className="ok"; $("msg").textContent=T[currentLang].saved;
    };
    $("btn_refresh").onclick = refresh;

    // ĞĞ²Ñ‚Ğ¾-Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğ¸ Ğ°Ğ´Ñ€ĞµÑĞ°
    if(saved){ refresh(); }
  </script>
</body>
</html>
