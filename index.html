<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ton21 Wallet ‚Äî Mini App</title>
  <style>
    body{background:radial-gradient(circle at center,#0d0d12 0%,#000 100%);color:#f8e49a;
      font-family:"Segoe UI",Arial,sans-serif;text-align:center;margin:0;padding:0;overflow-x:hidden}
    header{padding:40px 10px 16px}
    header img{width:110px;height:110px;border-radius:50%;border:3px solid #f8e49a;
      box-shadow:0 0 25px 8px rgba(255,215,100,.4);animation:pulse 3s infinite ease-in-out}
    @keyframes pulse{0%{box-shadow:0 0 20px 4px rgba(255,215,100,.4)}
      50%{box-shadow:0 0 40px 15px rgba(255,215,100,.7)}100%{box-shadow:0 0 20px 4px rgba(255,215,100,.4)}}
    h1{font-size:26px;color:#ffdc73;margin:16px 0 6px;text-shadow:0 0 10px #f1c84b}
    p.sub{color:#d6d6d6;font-size:15px;margin:0 24px 18px;line-height:1.4}

    .card{background:rgba(255,255,255,.05);border:1px solid #f8e49a33;border-radius:14px;
      padding:16px;margin:12px auto;max-width:420px}
    .row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px}
    input.addr{flex:1;min-width:240px;max-width:420px;background:#101018;color:#fff;border:1px solid #f8e49a33;
      border-radius:10px;padding:12px 14px;font-size:14px;outline:none}
    .btn{display:inline-block;background:linear-gradient(180deg,#f8e49a,#e4c55c);color:#0b0b0f;border:none;
      border-radius:10px;padding:12px 16px;font-size:15px;font-weight:700;cursor:pointer;transition:.2s}
    .btn:hover{transform:scale(1.03);box-shadow:0 0 18px rgba(255,230,120,.6)}
    .btn.link{width:80%;max-width:320px;display:block;margin:10px auto}

    .balances{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .tile{background:#0f121a;border:1px solid #f8e49a33;border-radius:10px;padding:12px}
    .tile h4{margin:0 0 6px;font-size:13px;color:#cfcfcf}
    .val{font-size:18px;font-weight:800;color:#ffea9f}

    .lang{margin:18px 0 10px;font-size:14px;color:#aaa}
    .lang button{background:none;border:1px solid #f8e49a;color:#f8e49a;margin:4px;border-radius:6px;
      padding:4px 10px;cursor:pointer}
    .muted{color:#a1a1a1;font-size:12px;margin-top:6px}
    footer{margin:24px 0 26px;color:#777;font-size:13px}
    .err{color:#ffb3b3;font-size:13px;margin-top:8px}
    .ok{color:#9fffb3;font-size:13px;margin-top:8px}
  </style>
</head>
<body>
  <header>
    <img src="https://raw.githubusercontent.com/ton21-official/ton21_official/main/logo.png" alt="Ton21 Logo"/>
    <h1 id="t_title">‚ú® Welcome to Ton21 Wallet ‚ú®</h1>
    <p class="sub" id="t_desc">üíé Your decentralized gateway to the Ton21 ecosystem.</p>
  </header>

  <!-- Address & Actions -->
  <div class="card">
    <div class="row">
      <input id="addr" class="addr" placeholder="UQ... / EQ..." />
      <button class="btn" id="btn_save">üíæ Save</button>
      <button class="btn" id="btn_refresh">üîÑ Refresh</button>
    </div>
    <div class="muted" id="hint">Paste your Tonkeeper address (starts with UQ or EQ)</div>
    <div id="msg"></div>

    <div class="balances">
      <div class="tile">
        <h4>TON</h4>
        <div class="val" id="ton_val">‚Äî</div>
      </div>
      <div class="tile">
        <h4>T21</h4>
        <div class="val" id="t21_val">‚Äî</div>
      </div>
    </div>
  </div>

  <!-- Links -->
  <div class="card">
    <button class="btn link" onclick="openLink('https://dedust.io/swap/TON/T21')" id="b1">üí∞ Buy $T21</button>
    <button class="btn link" onclick="openLink('https://dedust.io/swap/T21/TON')" id="b2">üîÅ Swap Tokens</button>
    <button class="btn link" onclick="openLink('https://t.me/Ton21PortalBot')" id="b5">üåê Ton21 Portal</button>
    <button class="btn link" onclick="openLink('https://t.me/T21BuyBot')" id="b4">ü™ô Buy Assistant</button>
  </div>

  <!-- Language -->
  <div class="lang">
    üåê Language:
    <button onclick="setLang('ru')">üá∑üá∫</button>
    <button onclick="setLang('en')">üá¨üáß</button>
    <button onclick="setLang('zh')">üá®üá≥</button>
    <button onclick="setLang('hi')">üáÆüá≥</button>
  </div>

  <footer>¬© 2025 Ton21 Project ‚Äî All rights reserved</footer>

  <script>
    // ========= CONFIG =========
    const TONCENTER_URL = "https://toncenter.com/api/v2/";
    const TONCENTER_KEY = "7b7dbe074f508388d81130af3a79b5a2cf955084f3e3b088aa7ecba4419c2317";
    const T21_MASTER    = "EQBLgiPMly982IMGqauqdX0Fe_N01arD-LhlKSfxBd8rzYRG";

    // If CORS —É–ø—Ä—ë—Ç—Å—è, —É–∫–∞–∂–∏ –∞–¥—Ä–µ—Å —Å–≤–æ–µ–≥–æ –ª—ë–≥–∫–æ–≥–æ –ø—Ä–æ–∫—Å–∏ (–æ—Å—Ç–∞–≤—å "" –¥–ª—è –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤):
    // –ø—Ä–∏–º–µ—Ä proxy: https://your-render-app.onrender.com/toncenter?path=...&params=...
    const proxyUrl = ""; // –ª–∏–±–æ "" –¥–ª—è –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

    // ========= I18N =========
    const T = {
      en:{title:"‚ú® Welcome to Ton21 Wallet ‚ú®", desc:"üíé Your decentralized gateway to the Ton21 ecosystem.",
        hint:"Paste your Tonkeeper address (starts with UQ or EQ)",
        saved:"‚úÖ Address saved", invalid:"‚ö†Ô∏è Invalid address", errFetch:"‚ö†Ô∏è Error: ", okUpdated:"‚úÖ Updated",
        b1:"üí∞ Buy $T21", b2:"üîÅ Swap Tokens", b4:"ü™ô Buy Assistant", b5:"üåê Ton21 Portal"},
      ru:{title:"‚ú® –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Ton21 –ö–æ—à–µ–ª—ë–∫ ‚ú®", desc:"üíé –¢–≤–æ–π –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ä—Ç–∞–ª –≤ —ç–∫–æ—Å–∏—Å—Ç–µ–º—É Ton21.",
        hint:"–í—Å—Ç–∞–≤—å Tonkeeper-–∞–¥—Ä–µ—Å (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å UQ –∏–ª–∏ EQ)",
        saved:"‚úÖ –ê–¥—Ä–µ—Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω", invalid:"‚ö†Ô∏è –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å", errFetch:"‚ö†Ô∏è –û—à–∏–±–∫–∞: ", okUpdated:"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ",
        b1:"üí∞ –ö—É–ø–∏—Ç—å $T21", b2:"üîÅ –û–±–º–µ–Ω / Swap", b4:"ü™ô –ü–æ–º–æ—â–Ω–∏–∫ –ø–æ–∫—É–ø–∫–∏", b5:"üåê –ü–æ—Ä—Ç–∞–ª Ton21"},
      zh:{title:"‚ú® Ê¨¢ËøéÊù•Âà∞ Ton21 Èí±ÂåÖ ‚ú®", desc:"üíé ËøõÂÖ• Ton21 ÁîüÊÄÅÁ≥ªÁªüÁöÑÂéª‰∏≠ÂøÉÂåñÈó®Êà∑„ÄÇ",
        hint:"Á≤òË¥¥ Tonkeeper Âú∞ÂùÄÔºà‰ª• UQ Êàñ EQ ÂºÄÂ§¥Ôºâ",
        saved:"‚úÖ Âú∞ÂùÄÂ∑≤‰øùÂ≠ò", invalid:"‚ö†Ô∏è Âú∞ÂùÄÊó†Êïà", errFetch:"‚ö†Ô∏è ÈîôËØØÔºö", okUpdated:"‚úÖ Â∑≤Êõ¥Êñ∞",
        b1:"üí∞ Ë¥≠‰π∞ $T21", b2:"üîÅ ‰ª£Â∏Å‰∫§Êç¢", b4:"ü™ô Ë¥≠‰π∞Âä©Êâã", b5:"üåê Ton21 Èó®Êà∑"},
      hi:{title:"‚ú® Ton21 ‡§µ‡•â‡§≤‡•á‡§ü ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à ‚ú®", desc:"üíé Ton21 ‡§™‡§æ‡§∞‡§ø‡§∏‡•ç‡§•‡§ø‡§§‡§ø‡§ï‡•Ä ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§ï‡§æ ‡§Ü‡§™‡§ï‡§æ ‡§µ‡§ø‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡•Ä‡§ï‡•É‡§§ ‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§¶‡•ç‡§µ‡§æ‡§∞‡•§",
        hint:"Tonkeeper ‡§™‡§§‡§æ ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (UQ ‡§Ø‡§æ EQ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§π‡•ã‡§§‡§æ ‡§π‡•à)",
        saved:"‚úÖ ‡§™‡§§‡§æ ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ", invalid:"‚ö†Ô∏è ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§™‡§§‡§æ", errFetch:"‚ö†Ô∏è ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø: ", okUpdated:"‚úÖ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ",
        b1:"üí∞ $T21 ‡§ñ‡§∞‡•Ä‡§¶‡•á‡§Ç", b2:"üîÅ ‡§ü‡•ã‡§ï‡§® ‡§∏‡•ç‡§µ‡•à‡§™ ‡§ï‡§∞‡•á‡§Ç", b4:"ü™ô ‡§ñ‡§∞‡•Ä‡§¶ ‡§∏‡§π‡§æ‡§Ø‡§ï", b5:"üåê Ton21 ‡§™‡•ã‡§∞‡•ç‡§ü‡§≤"}
    };

    function setLang(lang){
      const t=T[lang]||T.en;
      document.getElementById("t_title").innerText=t.title;
      document.getElementById("t_desc").innerText=t.desc;
      document.getElementById("hint").innerText=t.hint;
      document.getElementById("b1").innerText=t.b1;
      document.getElementById("b2").innerText=t.b2;
      document.getElementById("b4").innerText=t.b4;
      document.getElementById("b5").innerText=t.b5;
      localStorage.setItem("t21_lang",lang);
    }

    // ========= Helpers =========
    function openLink(url){
      if(window.Telegram&&Telegram.WebApp){Telegram.WebApp.openLink(url);} else {window.open(url,"_blank");}
    }
    const $ = id => document.getElementById(id);
    function validAddr(a){ return (a||"").trim().match(/^(UQ|EQ)[A-Za-z0-9\-_]{30,}$/); }

    async function tcGet(path, params={}){
      const p = new URLSearchParams({...params, api_key: TONCENTER_KEY}).toString();
      if(proxyUrl){
        // —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
        const u = `${proxyUrl}&path=${encodeURIComponent(path)}&${p}`;
        const r = await fetch(u);
        return r.json();
      }else{
        // –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤
        const u = `${TONCENTER_URL}${path}?${p}`;
        const r = await fetch(u);
        return r.json();
      }
    }

    async function getTonBalance(address){
      const j = await tcGet("getAddressBalance",{address});
      if(!("result" in j)) throw new Error(j.error||"no result");
      return Number(j.result)/1e9;
    }

    async function getT21Balance(address){
      // —Å–ø—Ä–∞—à–∏–≤–∞–µ–º jetton_wallet_info –ø–æ master –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É T21
      const j = await tcGet("get_jetton_wallet_info",{address, jetton_master:T21_MASTER});
      const res = j.result || {};
      if("balance" in res){ return Number(res.balance)/1e9; }
      return 0.0; // –µ—Å–ª–∏ –∫–æ—à–µ–ª—ë–∫ jetton –Ω–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç
    }

    async function refresh(){
      const addr = $("addr").value.trim();
      const msg = $("msg");
      msg.className = ""; msg.textContent = "";
      if(!validAddr(addr)){ msg.className="err"; msg.textContent=T[currentLang].invalid; return; }

      $("ton_val").textContent = "‚Ä¶";
      $("t21_val").textContent = "‚Ä¶";

      try{
        const [ton,t21] = await Promise.all([getTonBalance(addr), getT21Balance(addr)]);
        $("ton_val").textContent = ton.toFixed(4);
        $("t21_val").textContent = t21.toFixed(2);
        msg.className="ok"; msg.textContent=T[currentLang].okUpdated;
        localStorage.setItem("t21_addr", addr);
      }catch(e){
        $("ton_val").textContent = "‚Äî";
        $("t21_val").textContent = "‚Äî";
        msg.className="err"; msg.textContent = T[currentLang].errFetch + (e.message||e);
      }
    }

    // ========= Init =========
    let currentLang = localStorage.getItem("t21_lang") || (navigator.language||"en").slice(0,2);
    if(!T[currentLang]) currentLang="en";
    setLang(currentLang);

    const saved = localStorage.getItem("t21_addr");
    if(saved){ $("addr").value = saved; }

    $("btn_save").onclick = ()=>{
      const v = $("addr").value.trim();
      if(!validAddr(v)){ $("msg").className="err"; $("msg").textContent=T[currentLang].invalid; return; }
      localStorage.setItem("t21_addr", v);
      $("msg").className="ok"; $("msg").textContent=T[currentLang].saved;
    };
    $("btn_refresh").onclick = refresh;

    // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞–¥—Ä–µ—Å–∞
    if(saved){ refresh(); }
  </script>
</body>
</html>
